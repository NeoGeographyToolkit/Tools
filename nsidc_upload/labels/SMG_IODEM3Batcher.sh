#!/bin/sh
SHRTNAME=IODEM3
HOST=`uname -n`
FDATE=`date`
#CAMP=2012_AN_NASA


# WORD TO REPLACE IN CONFIG FILES WHEN BATCHING THESE GET REPLACE WITH DATA DIRECTORY NAMES EACH LOOP
# WHEN BATCH FINISHES IT GETS SET BACK TO 'DATADIR' FOR NEXT BATCH RUN
VAR=DATADIR

ROOTDIR=/u/smcmich1/icebridge/upload_software


#for i in AN_2012.10.15 GR_2014.03.12 AN_2009.10.16 GR_2014.03.13 GR_2014.03.14 AN_2009.10.21 GR_2014.03.15 AN_2009.10.24 GR_2014.03.17 GR_2014.03.18 GR_2014.03.19 GR_2014.03.21 GR_2014.03.24 GR_2014.03.26 GR_2014.03.28 GR_2014.03.31 GR_2014.04.03 GR_2014.04.28 AN_2013.11.20 GR_2011.03.16 GR_2011.03.17 GR_2011.03.22 GR_2011.03.23 GR_2011.03.25 AN_2010.10.26 GR_2011.03.26 AN_2010.10.28 AN_2010.10.30 AN_2010.11.04 GR_2011.03.28 AN_2010.11.05 AN_2010.11.06 AN_2010.11.10 AN_2010.11.13 GR_2012.03.14 AN_2010.11.19 GR_2012.03.15 AN_2010.11.20 GR_2012.03.16 AN_2011.10.12 GR_2012.03.17 GR_2012.03.19 AN_2011.10.13 GR_2012.03.21 AN_2011.10.14 AN_2011.10.17 GR_2012.03.22 AN_2011.10.18 GR_2012.03.23 AN_2011.10.20 GR_2012.03.26 AN_2011.10.21 GR_2012.03.27 GR_2012.03.28 AN_2011.10.23 GR_2012.03.29 AN_2011.10.24 GR_2012.04.02 GR_2013.03.20 GR_2013.03.21 AN_2011.10.25 AN_2011.10.26 GR_2013.03.22 AN_2011.10.29 AN_2011.10.30 GR_2013.03.23 AN_2011.11.03 AN_2011.11.04 GR_2013.03.24 AN_2011.11.07 GR_2013.03.26 AN_2011.11.09 AN_2011.11.11 GR_2013.03.27 AN_2011.11.12 AN_2011.11.13 GR_2013.04.24 AN_2011.11.16 GR_2013.04.25 AN_2011.11.19 AN_2012.10.12 AN_2012.10.13 AN_2012.10.16 AN_2012.10.18 AN_2012.10.19 AN_2012.10.22 AN_2012.10.25 AN_2012.10.27 AN_2012.10.28 AN_2012.11.01 AN_2012.11.02 AN_2012.11.04 AN_2012.11.06 AN_2012.11.07 AN_2014.10.16 AN_2014.10.20 AN_2014.11.13 AN_2016.10.17 AN_2016.10.22 AN_2016.10.27 GR_2010.03.22 GR_2010.03.23 GR_2010.03.24 GR_2010.04.12 GR_2010.04.19 GR_2010.04.20 GR_2010.04.21 GR_2015.03.24 GR_2015.03.26 GR_2015.03.27 GR_2015.03.29 GR_2015.03.30 GR_2015.04.01 GR_2015.04.03 GR_2015.05.08 GR_2015.10.05 GR_2015.03.19 GR_2015.03.25 GR_2015.09.28 GR_2016.07.13 GR_2016.07.21 GR_2016.07.19 GR_2016.07.14


for i in AN_2009.10.16 AN_2009.10.21 
do

#LOC=`echo $i | cut -f1 -d_ `
#YEAR=`echo $i | cut -f2 -d_ |cut -f1 -d'.'`
#CAMP=${YEAR}_${LOC}_NASA
#echo CAMP
#echo $CAMP
#sleep 2

  echo "Working on $i "

  # UPDATE PRIMARY CONFIG FILE
  sed "{s:$VAR:$i:}" ${ROOTDIR}/Primary.cfg  >  ${ROOTDIR}/Primary2.cfg
  mv ${ROOTDIR}/Primary2.cfg ${ROOTDIR}/Primary.cfg 
  
  ${ROOTDIR}/MetGen.Start -config ${ROOTDIR}/Primary.cfg
  #${ROOTDIR}/MetGen.Start -config ${ROOTDIR}/Primary.cfg -C ${CAMP}
  
  echo $i completed  >> ${ROOTDIR}/${SHRTNAME}_Batch.log

  # GRAB INFO FROM SMG LOG FOR BATCH LOG
  tail -100 ${ROOTDIR}/logs/SIPSMetGen.log | grep "Number of granules"  >> ${ROOTDIR}/${SHRTNAME}_Batch.log
  date >> ${ROOTDIR}/${SHRTNAME}_Batch.log

  VAR=$i

done


# put DATADIR BACK IN PRIMRY CONFIG FOR NEXT BATCH
i=DATADIR
sed "{s:$VAR:$i:}" ${ROOTDIR}/Primary.cfg  >  ${ROOTDIR}/Primary2.cfg
mv ${ROOTDIR}/Primary2.cfg ${ROOTDIR}/Primary.cfg 

